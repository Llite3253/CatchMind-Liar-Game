<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë°© ì„ íƒ</title>

    <style>
        body {
            background: #f2f2f2;
            font-family: Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .room-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 350px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .room-btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            background: #00aaff;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        .room-btn:hover {
            background: #0088cc;
        }
        input {
            padding: 10px;
            width: 80%;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #aaa;
        }
    </style>
</head>
<body>

<div class="room-box">

    <h2>ğŸ¨ ë°© ì„ íƒ</h2>

    <div id="roomList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <hr style="margin: 20px">

    <h3>ë°© ìƒì„±í•˜ê¸°</h3>
    <input id="newRoomName" placeholder="ë°© ì´ë¦„ ì…ë ¥">
    <button class="room-btn" onclick="createRoom()">ë°© ìƒì„±</button>

</div>

<script>
    async function loadRooms() {
        const list = document.getElementById("roomList");
        list.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

        const res = await fetch("/cmind/rooms/list");
        const rooms = await res.json();

        if (rooms.length === 0) {
            list.innerHTML = "<p>ìƒì„±ëœ ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }

        list.innerHTML = "";
        rooms.forEach(room => {
            const btn = document.createElement("button");
            btn.className = "room-btn";
            btn.innerHTML = `${room.name} (ID: ${room.id})<br>(${room.count}ëª… / 8ëª…)`;
            btn.onclick = () => enterRoom(room.id);
            list.appendChild(btn);
        });
    }

    function enterRoom(roomId) {
        location.href = "/chat.html?room=" + roomId;
    }

    async function createRoom() {
        const name = document.getElementById("newRoomName").value;
        if (!name) return alert("ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");

        const res = await fetch("/cmind/rooms", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({name})
        });

        const newRoom = await res.json();

        // 2ï¸âƒ£ ìƒì„±ëœ ë°©ì˜ idë¡œ chat.html í˜ì´ì§€ ì´ë™
        location.href = "/chat.html?room=" + newRoom.id;
    }

    loadRooms();
</script>

</body>
</html>
